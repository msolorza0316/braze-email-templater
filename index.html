<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>JSON Form Generator</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f5f5f5;
        display: flex;
        flex-direction: column; /* Stack vertically */
        align-items: center;    /* Center horizontally */
    }

    #formContainer {
        max-width: 800px;
        width: 100%;
    }

    .form-section {
        background: #fff;
        border: 1px solid #ddd;
        margin-bottom: 20px;
        padding: 15px;
        border-radius: 6px;
    }

    .form-section h2 {
        background: #eee;
        margin: -15px -15px 15px -15px;
        padding: 10px;
        font-size: 1.2em;
    }

    label {
        display: block;
        margin-top: 10px;
        font-weight: bold;
    }

    input[type="text"], textarea {
        width: 100%;
        padding: 6px;
        margin-top: 4px;
        box-sizing: border-box;
    }

    .bullet-container {
        border: 1px solid #ccc;
        padding: 10px;
        border-radius: 4px;
        background: #fafafa;
    }

    .bullet-item {
        margin-bottom: 10px;
        padding-bottom: 10px;
        border-bottom: 1px dashed #ccc;
    }

    .bullet-item:last-child {
        border-bottom: none;
    }

    #generateBtn {
        padding: 10px 20px;
        font-size: 1em;
        background: #28a745;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-bottom: 20px;
    }

    pre {
        background: #272822;
        color: #f8f8f2;
        padding: 10px;
        border-radius: 4px;
        overflow: auto;
        width: 60%;
        white-space: pre-wrap;
    }
</style>
</head>
<body>

<div id="formContainer"></div>
<button id="generateBtn">Generate JSON</button>
<pre id="output"></pre>

<script>
const template = {
    "modal": {
        "members": {
            "detailStep": {
                "title": "",
                "ctaText": "",
                "subtitleText": ""
            },
            "welcomeStep": {
                "items": [
                    { "text": "", "description": "" },
                    { "text": "", "description": "" },
                    { "text": "", "description": "" }
                ],
                "title": "",
                "copyText": "",
                "abortText": "",
                "termsText": "",
                "continueText": "",
                "subtitleText": ""
            },
            "redirectStep": {
                "title": "",
                "ctaText": "",
                "subtitleText": ""
            }
        },
        "anonymous": {
            "loginStep": {
                "title": "",
                "subtitleText": ""
            },
            "welcomeStep": {
                "items": [
                    { "text": "", "description": "" },
                    { "text": "", "description": "" },
                    { "text": "", "description": "" }
                ],
                "title": "",
                "copyText": "",
                "abortText": "",
                "termsText": "",
                "continueText": "",
                "subtitleText": ""
            }
        }
    },
    "banner": {
        "mode": "",
        "title": "",
        "ctaText": "",
        "iconUrl": "",
        "copyText": "",
        "metaData": {
            "niche": "",
            "productId": "",
            "productName": "",
            "redirectUrl": "",
            "providerName": ""
        },
        "badgeText": "",
        "termsText": "",
        "titleHighlight": ""
    },
    "common": {
        "termsUrl": ""
    }
};

const labelOverrides = {
    "banner.metaData": "Metadata",
    "banner.metaData.niche": "niche",
    "banner.metaData.productId": "Product ID",
    "banner.metaData.productName": "Product Name",
    "banner.metaData.redirectUrl": "Redirect URL",
    "banner.metaData.providerName": "Provider Name",
    "items": "Bullet points",
    "text": "Main text (bold)",
    "description": "Secondary text"
};

let valueMap = new Map();

function renderInput(label, fieldId) {
    const wrapper = document.createElement("div");
    const lbl = document.createElement("label");
    lbl.textContent = label;
    const inp = document.createElement("input");
    inp.type = "text";
    inp.dataset.fieldId = fieldId;
    wrapper.appendChild(lbl);
    wrapper.appendChild(inp);
    return wrapper;
}

function renderBulletPoints(array, path) {
    const container = document.createElement("div");
    container.className = "bullet-container";
    array.forEach((item, index) => {
        const bulletDiv = document.createElement("div");
        bulletDiv.className = "bullet-item";
        let mainId = `${path.join(".")}.${index}.text`;
        let secId = `${path.join(".")}.${index}.description`;
        valueMap.set(mainId, { paths: [[...path, index, "text"]], id: mainId });
        valueMap.set(secId, { paths: [[...path, index, "description"]], id: secId });
        bulletDiv.appendChild(renderInput("Main text (bold)", mainId));
        bulletDiv.appendChild(renderInput("Secondary text", secId));
        container.appendChild(bulletDiv);
    });
    return container;
}

function renderSection(sectionName, obj, prefix = []) {
    const sectionDiv = document.createElement("div");
    sectionDiv.className = "form-section";

    let sectionLabel = labelOverrides[prefix.join(".")] || sectionName;
    if (sectionLabel) {
        sectionDiv.innerHTML = `<h2>${sectionLabel}</h2>`;
    }

    for (let key in obj) {
        const value = obj[key];
        const path = [...prefix, key];

        if (Array.isArray(value) && key === "items") {
            sectionDiv.appendChild(renderBulletPoints(value, path));
        } else if (typeof value === "object" && value !== null) {
            if (key === "metaData") {
                // Flatten metaData directly, no extra box
                for (let metaKey in value) {
                    let metaId = `${path.join(".")}.${metaKey}`;
                    valueMap.set(metaId, { paths: [[...path, metaKey]], id: metaId });
                    sectionDiv.appendChild(renderInput(labelOverrides[path.join(".") + "." + metaKey] || metaKey, metaId));
                }
            } else {
                sectionDiv.appendChild(renderSection(key, value, path));
            }
        } else {
            let fieldId = path.join(".");
            valueMap.set(fieldId, { paths: [path], id: fieldId });
            sectionDiv.appendChild(renderInput(labelOverrides[path.join(".")] || key, fieldId));
        }
    }
    return sectionDiv;
}

const formContainer = document.getElementById("formContainer");
formContainer.appendChild(renderSection("Banner", template.banner, ["banner"]));
formContainer.appendChild(renderSection("Modal - Members", template.modal.members, ["modal", "members"]));
formContainer.appendChild(renderSection("Modal - Anonymous", template.modal.anonymous, ["modal", "anonymous"]));
formContainer.appendChild(renderSection("Common", template.common, ["common"]));

document.getElementById("generateBtn").addEventListener("click", () => {
    let updatedJSON = JSON.parse(JSON.stringify(template));
    document.querySelectorAll("[data-field-id]").forEach(inp => {
        valueMap.forEach((data) => {
            if (data.id === inp.dataset.fieldId) {
                data.paths.forEach(path => {
                    let ref = updatedJSON;
                    for (let i = 0; i < path.length - 1; i++) ref = ref[path[i]];
                    ref[path[path.length - 1]] = inp.value;
                });
            }
        });
    });
    document.getElementById("output").textContent = JSON.stringify(updatedJSON, null, 4);
});
</script>
<script>
  window.onload = function() {
    parent.postMessage(document.body.scrollHeight, "*");
  };
</script>
</body>
</html>
